{% extends "layout.html" %}
{% block title %}Parcels{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Copy admin sidebar, active: Parcels -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Admin Panel</h2>
            <p>Welcome, {{ session.name }}</p>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="{{ url_for('admin_dashboard') }}" class="active">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a></li>
                <li><a href="{{ url_for('admin_staff') }}">
                    <i class="fas fa-users-cog"></i> Staff Management
                </a></li>
                <li><a href="{{ url_for('admin_customers') }}">
                    <i class="fas fa-user-friends"></i> Customers
                </a></li>
                <li><a href="{{ url_for('admin_parcels') }}">
                    <i class="fas fa-boxes"></i> Parcels
                </a></li>
                <li><a href="{{ url_for('admin_track') }}">
                    <i class="fas fa-map-marker-alt"></i> Track Parcel
                </a></li>
                <li><a href="{{ url_for('admin_reports') }}">
                    <i class="fas fa-chart-bar"></i> Reports
                </a></li>
                <li><a href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <h1>All Parcels</h1>

        {% if parcels %}
        <div class="table-responsive">
            <table class="table table-hover">

                <thead>
                     <tr> 
                        <th>Tracking ID</th>
                        <th>Customer</th>
                        <th>Receiver</th>
                        <th>Staff</th>
                        <th>Weight</th>
                        <th>Cost</th>
                        <th>Status</th>
                        <th>Payment</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for parcel in parcels %}
                    <tr>
                        <td>{{ parcel['tracking_id'] }}</td>
                        <td>{{ parcel['customer_name'] }}</td>
                        <td>{{ parcel['receiver_name'] }}</td>
                        <td>{{ parcel['staff_name'] or 'Not Assigned' }}</td>
                        <td>{{ parcel['weight'] }}kg</td>
                        <td>â‚¹{{ parcel['cost'] }}</td>
                        <td>
                            <span class="status-badge status-{{ parcel['status'] }}">
                                {{ parcel['status']|replace(' ', '-')|title }}
                            </span>
                        </td> 
                          Payment Status Column 
<td>
    {% if parcel.payment_status == "paid" %}
        <span class="badge bg-success">PAID</span>
    {% else %}
        {% if parcel.status == "delivered" %}
            <form method="POST" action="/admin/mark_paid/{{ parcel.tracking_id }}" 
                  style="display:inline;" onsubmit="return confirm('Mark as paid?')">
                <button type="submit" class="btn btn-sm btn-warning">Mark Paid</button>
            </form>
        {% else %}
            <span class="badge bg-warning">Pending</span>
        {% endif %}
    {% endif %}
</td>

                        <td>
                            <span class="badge {{ 'bg-success' if parcel['payment_status'] == 'paid' else 'bg-warning' }}">
                                {{ parcel['payment_status']|title }}
                            </span>
                        </td>
                        
                        
                        <td>{{ parcel['created_at'].strftime('%Y-%m-%d') }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('admin_update_parcel_status') }}" 
                                  style="display: inline;" class="me-2">
                                <input type="hidden" name="tracking_id" value="{{ parcel['tracking_id'] }}">
                                <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                                    <option value="booked" {% if parcel['status'] == 'booked' %}selected{% endif %}>Booked</option>
                                    <option value="picked" {% if parcel['status'] == 'picked' %}selected{% endif %}>Picked</option>
                                    <option value="in transit" {% if parcel['status'] == 'in transit' %}selected{% endif %}>In Transit</option>
                                    <option value="out for delivery" {% if parcel['status'] == 'out for delivery' %}selected{% endif %}>Out for Delivery</option>
                                    <option value="delivered" {% if parcel['status'] == 'delivered' %}selected{% endif %}>Delivered</option>
                                </select>
                            </form>
                             Simple Add button 
 <a href="{{ url_for('admin_add_parcel') }}"
   class="btn btn-sm btn-success">
    Add
</a>

                            <a href="{{ url_for('admin_delete_parcel', tracking_id=parcel['tracking_id']) }}" 
                               class="btn btn-sm" 
                               onclick="return confirm('Delete this parcel?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr> 
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-boxes fa-3x text-muted mb-3"></i>
            <h5>No parcels found</h5>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}
